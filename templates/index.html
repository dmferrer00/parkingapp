<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>UNC Charlotte Parking Predictor</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <h1>🚗 UNC Charlotte Parking Predictor 🚗</h1>

  <p>___________________<u>Select a parking deck</u>___________________</p>
  <div id="deck-buttons"></div>

  <div id="result" style="margin-top: 20px;"></div>

  <!-- Updated JavaScript to handle deck -> level -> prediction -->
  <script>
    const decks = {
      "North": ["Level 1", "Level 2", "Level 3", "Level 4", "Level 5", "Level 6"],
      "CRI Deck 1": ["Level 1", "Level 2", "Level 3", "Level 4", "Level 5", "Level 6", "Level 7"],
      "South Village": ["Level 1", "Level 2", "Level 3", "Level 4", "Level 5", "Level 6"],
      "Union": ["Level 1", "Level 2", "Level 3", "Level 4", "Level 5", "Level 6"],
      "West": ["Level 1", "Level 2", "Level 3", "Level 4", "Level 5"],
      "East 3": ["Level 1", "Level 2", "Level 3", "Level 4", "Level 5"],
      "East 2": ["Level 1", "Level 2", "Level 3", "Level 4"],
      "East 1": ["Level 1", "Level 2", "Level 3", "Level 4"]
    };

    const buttonsDiv = document.getElementById("deck-buttons");
    const resultDiv = document.getElementById("result");

    function clearButtons() {
      buttonsDiv.innerHTML = "";
    }

    // Show level buttons
    function showLevelButtons(deckName) {
      clearButtons();
      decks[deckName].forEach(level => {
        const levelButton = document.createElement("button");
        levelButton.innerText = level;
        levelButton.className = "level-button";
        levelButton.onclick = () => predict(`${deckName} ${level}`);
        buttonsDiv.appendChild(levelButton);
      });

      // Back button
      const backButton = document.createElement("button");
      backButton.innerText = "⬅️ Back to Decks";
      backButton.className = "back-button";
      backButton.style.marginTop = "20px";
      backButton.onclick = () => showDeckButtons();
      buttonsDiv.appendChild(backButton);
    }

    // Show deck buttons
    function showDeckButtons() {
      clearButtons();
      Object.keys(decks).forEach(deckName => {
        const deckButton = document.createElement("button");
        deckButton.innerText = deckName;
        deckButton.className = "deck-button";
        deckButton.onclick = () => showLevelButtons(deckName);
        buttonsDiv.appendChild(deckButton);
      });
      resultDiv.innerHTML = "";
    }

    // Predict function
    async function predict(location) {
      const response = await fetch("/predict", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ location })
      });

      const data = await response.json();

      resultDiv.innerHTML = `
        <div style="background-color: #f0f4ff; padding: 20px; border-radius: 10px; margin-top: 20px; max-width: 400px; text-align: center;">
          <h3>Prediction for <strong>${data.location}</strong></h3>
          <p><strong> Day:</strong> ${data.day}</p>
          <p><strong> Time Block:</strong> ${data.time}</p>
          <p><strong> Availability:</strong> <span style="color: ${data.availability === 'Empty' ? 'green' : data.availability === 'Moderate' ? 'orange' : 'red'}; font-weight: bold;">${data.availability} (${data.confidence}% confident)</span></p>
          <p><strong> Estimated Spaces:</strong> ${data.spaces}</p>
        </div>
      `;
    }

    // Run it all
    showDeckButtons();
  </script>

  <!-- Then load any external scripts (this should be LAST) -->
  <script src="/static/script.js"></script>

</body>
</html>
